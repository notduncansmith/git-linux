<!doctype html>
<html>
  <head>
    <title>Git-Linux</title>
    <link rel="stylesheet" href="stylesheets/foundation.min.css">
    <link rel="stylesheet" href="stylesheets/app.css">
    <link rel="stylesheet" href="./stylesheets/style.css"> 

    <script src="javascripts/modernizr.foundation.js"></script>
  </head>
  <body>
  <a href="/log" class="git">Log</a>
  <a href="/remotes" class="git">Show Remotes</a>
  <a href="#" id="diff">Diff</a>

  <form action="/repo/new" method="POST">
    <fieldset>
      <legend>New Repo</legend>
      <input type="text" name="repoName">
      <input type="submit">
    </fieldset>
  </form>

  <form action="/repo/get">
    <fieldset>
      <legend>Get A Repo</legend>
      <input type="text" name="repoId">
      <input type="submit">
    </fieldset>
  </form>


  <div class="output"></div>
    <div class="row">
      <div id="fileSelect" class="five columns"></div>
      <div class="two columns"></div>
      <div id="diffBox" class="five columns"></div>
    </div>
  </body>
    <script src="./javascripts/jquery.min.js"></script>
    <script type="text/javascript" src="./javascripts/parseDiff.js"></script>
    <script type="text/javascript" src="./javascripts/mustache.js"></script>
    <script type="text/javascript">
      $(function(){
        
      });
    </script>

    <script src="./javascripts/app.js"></script>
    <script>
      $(document).ready(function(){

        $("#diff").click(function(e){
          e.preventDefault();
          $.ajax({
            url: '/diff',
            success: function(data){
              console.log(data)
              var html = parseDiff(data);
              $('#fileSelect').html(html.fileSelect);
              $('#diffBox').html(html.diff);
            }
          })
        })
        
        $(".git").click(function(e){
          e.preventDefault();
          $.ajax({
            url: $(this).attr('href'),
            type: 'GET',
            success: function(data){
              if(data.stderr){
                $('.output').html(data.stderr).addClass('error');
              } else {
                $('.output').html(data.stdout);
              }
            }
          })
        })

        $("form").submit(function(e){
          e.preventDefault();
          $.ajax({
            url: $(this).attr('action'),
            type: $(this).attr('method') || "GET",
            data: $(this).serialize(),
            success: function(data){
              data = JSON.stringify(data)
              console.log(data)
              if(data.stderr){
                $('.output').html(data).addClass('error');
              } else {
                $('.output').html(data);
              }
            }
          })
        })
      })
    </script>
</html>
